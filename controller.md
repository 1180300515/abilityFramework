# 框架完善和扩展第一阶段

## 任务分工

### 郜文豪：完善设备资源的管理

#### 1、完善设备资源文件的读入

（1）从yaml文件中读取到的设备实例要能够在/api/Devices中获取到

（2）从yaml文件中读取到的设备实例，如果某个能力依赖于该设备，要能够在/api/AbilitySupport中体现出来

#### 2、完善设备占用的描述

（1）为设备添加占用标记（不用对用户暴露），如果一个设备正在被某个能力使用，此时在/api/AbilitySupport中不应出现

依赖设备和能力的区别 io forwarding （虚拟化）代码实现

资源层面共享 controller负责虚拟化设备，告诉能力，与操作系统无关  virtual device manager 资源：包含更显式信息的设备描述

### 朱泓舟：扩展controller插件

#### 1、完善能力描述

（1）在/api/AbilitySupport中添加index标记，用户根据index请求开启能力

（2）在/api/AbilitySupport中添加是否可复用标记，在/api/AbilityRunning中体现正在被使用的次数

复用：设备层是否可复用 

（3）在/api/AbilityRunning中添加index标记，用户根据index和复用标记请求复用能力

（4）在/api/AbilityRunning中添加跨端能力运行状态显示，用户可以考虑跨端复用能力

index用于区分同一类能力，进入到AbilityRunning列表后的能力index保持原样

index的生成：

1、hash能力实例描述字符串：需要确保字符串的拼接顺序每次相同

#### 2、完善能力运行控制过程：目前考虑优先完成相机能力和识别能力的controller

第一步：完善资源，提供参数范围properties （REST接口）

第二步：实现controller，支持设备实例化，运行中可配置参数



管理设备对应的实例

controllerManager 框架新加入查询controller状态的接口

1、向框架查能力种类，得到controller的port

2、向controller查询候选能力组合

3、请求具体index



每种controller管理和各自能力相关的能力

一类能力共用一个controller，创建一个http服务器，端口号随机

工作流程：

1、修改AbilitySupport和AbilityRunning接口，里面添加ip信息

2、开启http服务

3、循环广播自己的运行状态

生命周期管理：

1、框架加载过程中进行

controller与能力之间的参数交互

1、provisioning有一个默认参数

2、用户提供一组

3、能力依赖提供

gstreamer

相机controller接口

（1）（异步）开启相机并进行推流

| 接口描述               | 方法 | 路径            | 响应类型   |
| :--------------------- | ---- | --------------- | ---------- |
| 开启相机能力并进行推流 | POST | /api/cameraOpen | 操作状态码 |

参数：json格式

| 请求参数 | 参数类型 | 参数描述                         | 示例 |
| -------- | -------- | -------------------------------- | ---- |
| index    | int      | /api/AbilitySupport中查到的index | 0    |

返回：json格式

| 返回参数 | 参数类型 | 参数描述         |
| -------- | -------- | ---------------- |
| status   | int      | 本次操作的状态码 |

~~~
{
	"status": 200
}
~~~

（2）（同步）使用相机流

| 接口描述   | 方法 | 路径           | 响应类型     |
| :--------- | ---- | -------------- | ------------ |
| 使用相机流 | GET  | /api/cameraUse | 返回推流地址 |

参数：json格式

| 请求参数 | 参数类型 | 参数描述                         | 示例 |
| -------- | -------- | -------------------------------- | ---- |
| index    | int      | /api/AbilityRunning中查到的index | 0    |

返回：json格式

| 请求参数 | 参数类型 | 参数描述             |
| -------- | -------- | -------------------- |
| address  | string   | 相机推流到的目标地址 |
| status   | int      | 当前相机推流状态     |

~~~
{
	"status": 200
	"address": "rtsp://192.168.1.67:8554/camera"
}
~~~

（3）（异步）停止使用相机能力

| 接口描述                                                | 方法 | 路径             | 响应类型       |
| :------------------------------------------------------ | ---- | ---------------- | -------------- |
| 停止使用相机能力，若此时相机被使用次数为0则关闭相机能力 | POST | /api/cameraClose | 返回操作状态码 |

参数：json格式

| 请求参数 | 参数类型 | 参数描述                         | 示例 |
| -------- | -------- | -------------------------------- | ---- |
| index    | int      | /api/AbilityRunning中查到的index | 0    |

返回：json格式

| 请求参数 | 参数类型 | 参数描述         |
| -------- | -------- | ---------------- |
| status   | int      | 本次操作的状态码 |

~~~
{
	"status": 200
}
~~~

# 框架完善和扩展第二阶段

## 任务分工

### 郜文豪：实现能力依赖的解析过程

组件：管理候选能力

优先级定义：1、依赖关系计算代价（树形结构）resource schedule 2、设备计算能力 了解apt依赖计算过程

提高能力利用效率：1、回收能力：尽可能复用（计算设备的利用、虚拟化）

### 朱泓舟：完成其他能力的controller构建